{% extends 'exchange/base.html' %}
{% load static %}

{% block style %}
    .required:after {
        content:" *";
        color: red;
    }
    .required_before:before {
        content:"* ";
        color: red;
    }
{% endblock style %}

{% block head %}
    <title>Recherche Avancée</title>
{% endblock head %}

{% block intro %}
    <div id="intro" style="min-height: 0vh;">
        <ul class="actions">
            <li><a class="button icon solo fa-arrow-down scrolly" href="#nav">Continue</a></li>
        </ul>
    </div>
{% endblock intro %}

{% block main %}
    <header class="major">
        <h1>Recherche Avancée</h1>
        <p>Recherchez une université en fonction de filtres</p>
    </header>

    <div class="table-wrapper">
        <header><h3>Filtrer les Universitées selon:</h3></header>
        <form action="{% url 'search' %}"  method="post">
            {% csrf_token %}
            <label class="required" for="id_continent">continent&nbsp;:</label>
            <select id="id_continent" name="continent" onchange="myFunction()" required="">
                <option selected="" value="">---------</option>
                <option value="AS">Asie</option>
                <option value="AF">Afrique</option>
                <option value="AdN">Amerique du Nord</option>
                <option value="AdS">Amerique du Sud</option>
                <option value="EU">Europe</option>
                <option value="OC">Oceanie</option>
            </select>
            </br>
            <label for="id_name">Pays&nbsp;:</label>
            <select id="testt" name="name">
                <option value="" >---------</option>  
                {% for c in ttl %}
                <option id="{{c.ID}}" style="display:none;" value="{{ c.name }}">{{ c.name }}</option>
                {% endfor %}
            </select>
            </br>
            {{ formContract.as_p }}
            <hr>
            <h3>Ordonner les Universités selon:</h3>
            <label class="required" for="id_Ordre">Ordre&nbsp;:</label>
            <select id="id_Ordre" name="Ordre" required="">
                <option selected="" value="">---------</option>
                <option value="rank_metric">Ranking</option>
                <option value="life_metric">Qualité de Vie</option>
                <option value="name">Pays</option>
                <option value="CWUR_rank">Ranking Mondial</option>
                <option value="Demand">Demande</option>
            </select>
            </br>
            </hr>
            <input id="buton" type="submit" value="Rechercher">
        </form>
    </div>
    {% if valide %}
    <div class="table-wrapper">
        <h3>Liste des universités</h3>
        <p>Nombre d'éléments trouvés : {{universitiesC.count}}</p>
        <table>
            <thead>
                <tr>
                    <th>Nom</th>
                    <th>Note du département</th>
                    <th>Qualité de vie</th>
                    <th>Ville</th>
                    <th>Pays</th>
                    <th>Demande</th>
                    <th>Type de contrat avec l'INSA</th>

                </tr>
            </thead>
            <tbody>
                {% for u in universitiesC %}
                <tr>
                    <td><a href=/university/{{u.university.id}}>{{u.university.name}}</a></td>
                    <td>{{u.university.rank_metric}}</td>
                    <td>{{u.university.life_metric}}</td>
                    <td>{{u.university.city.name}}</td>
                    <td>{{u.university.city.country.name}}</td>
                    <td>{{u.university.demand}}</td>
                    <td>{{u.get_ContractType_display}}</td>
                </tr>
                {% endfor %}                                        
            </tbody>
        </table>
    </div>
    {% endif %}
    <p class="required_before" style="font-size:12px;"> - Champ requis</p>
{% endblock main %}

{% block scripts %}
    function myFunction() {
        //on prend le continent saisi par utilisatuer
        var cont = document.getElementById("id_continent").value
        console.log(cont)

        //on commence par cacher tout les pays
        {% for c in ttl %}
            if(cont == "{{c.continent}}"){
                document.getElementById("{{c.ID}}").setAttribute('style', 'display:block;');
            }else{
                document.getElementById("{{c.ID}}").setAttribute('style', 'display:none;');
            }
        {% endfor %}
        
    }
{% endblock scripts %}
